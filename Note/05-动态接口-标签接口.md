删除动态作为作业自行完成。



查询动态列表时，展示评论的个数。

要用到 SQL 子查询

修改 moment.service.js 文件中的 querylist 方法中的 statement。



展示动态详情时，展示评论详情

有很多种实现方式，

- LEFT JOIN 可以，但不好。

---

标签接口

多对多关系。

创建一张标签表。

- 表中没有 userId 字段，因为谁都可以用和创建标签。

创建标签接口编写，

获取标签列表接口编写，分页查询。

三层架构。

> 一对一，一张表
>
> 一对多：两张表
>
> 多对多：三张表



创建 moment 和 label 两表之间的关系表。

使用了联合主键。



补充发布动态接口，在其总加入发布动态和添加标签的接口。

用户选择的标签，要在关系表中，与 moment 关联。

用户新增的标签，要先插入到 label 表中，再与 moment 关联。



补充修改动态接口，为动态添加标签的接口。

处理这个接口，需要有如下中间件：

1.是否登录；

2.验证是否有操作这个动态的权限。

3.额外中间件，验证 label 的 name 是否已经存在于 label 表中。

- 如果存在，那么直接使用即可；
- 如果不存在，那么需要先将 label 的 name 添加到 label 表。

4.最后步骤

- 此时，素有 label 都在 label 表中；
- 将动态和 label 的 id，添加到关系表中。



> 任何操作数据库的代码，都可以写 try...catch

---

在动态列表查询接口中，查询标签的个数

同样的，用到子查询。

---

在查询动态列表的接口中，查询标签数组。

这里用左连接（LEFT JOIN）会出问题，

> LEFT JOIN 是根据前面 SQL 语句查询到的结果，进行左连接的。

处理方案

- 方案一：不要一次性查询，写两台哦 SQL；
- 方案二：写一条 SQL 语句，对查询的重复数据，进行去重。
- 方案三：SQL 语句写正确/完善。

处理这种情况，使用子查询，去除左连接之间的影响。